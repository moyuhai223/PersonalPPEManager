<UserControl x:Class="PersonalPPEManager.Views.PpeMasterManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:viewmodels="clr-namespace:PersonalPPEManager.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900"
             Background="White">
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="劳保用品主数据管理" FontSize="20" FontWeight="Bold" Margin="0,0,0,15"/>

        <TabControl Grid.Row="1">
            <TabItem Header="类别管理">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Content="添加新类别" Command="{Binding AddCategoryCommand}" Padding="10,5" Margin="0,0,10,0"/>
                        <Button Content="编辑选中类别" Command="{Binding EditCategoryCommand}" Padding="10,5" Margin="0,0,10,0"/>
                        <Button Content="删除选中类别" Command="{Binding DeleteCategoryCommand}" Padding="10,5" Background="LightCoral"/>
                        <Button Content="刷新列表" Command="{Binding LoadCategoriesCommand}" Padding="10,5" Margin="10,0,0,0"/>
                    </StackPanel>

                    <DataGrid Grid.Row="1" ItemsSource="{Binding AllCategories}" 
                              SelectedItem="{Binding SelectedCategory, Mode=TwoWay}"
                              AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" SelectionMode="Single">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="类别ID" Binding="{Binding CategoryID}" Width="80"/>
                            <DataGridTextColumn Header="类别名称" Binding="{Binding CategoryName}" Width="*"/>
                            <DataGridTextColumn Header="备注" Binding="{Binding Remarks}" Width="2*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="主数据条目管理">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Label Content="按类别筛选:" VerticalAlignment="Center"/>
                            <ComboBox ItemsSource="{Binding AllCategoriesForFilter}" DisplayMemberPath="CategoryName" 
                                      SelectedValuePath="CategoryID" 
                                      SelectedValue="{Binding SelectedFilterCategoryID, Mode=TwoWay}" 
                                      MinWidth="150" Margin="5,0,10,0" VerticalAlignment="Center"/>

                            <Button Content="刷新/应用筛选" 
                                     Command="{Binding LoadMasterItemsCommand}" 
                                     Padding="10,5" VerticalAlignment="Center"/>
                            <Button Content="清除筛选" Command="{Binding ClearMasterItemFilterCommand}" Padding="10,5" Margin="5,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Button Content="添加新主数据" Command="{Binding AddMasterItemCommand}" Padding="10,5" Margin="0,0,10,0"/>
                            <Button Content="编辑选中主数据" Command="{Binding EditMasterItemCommand}" Padding="10,5" Margin="0,0,10,0"/>
                            <Button Content="删除选中主数据" Command="{Binding DeleteMasterItemCommand}" Padding="10,5" Background="LightCoral" Margin="0,0,10,0"/>
                            <Button Content="导入主数据CSV" Command="{Binding ImportMasterItemsCommand}" Padding="10,5" Margin="0,0,10,0"/>
                            <Button Content="导出主数据CSV" Command="{Binding ExportMasterItemsCommand}" Padding="10,5"/>
                        </StackPanel>
                    </StackPanel>

                    <DataGrid Grid.Row="1" ItemsSource="{Binding DisplayMasterItems}" 
                              SelectedItem="{Binding SelectedMasterItemDisplay, Mode=TwoWay}" 
                              AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" SelectionMode="Single">
                              
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="主数据ID" Binding="{Binding ItemMasterID}" Width="80"/>
                            <DataGridTextColumn Header="用品主代码" Binding="{Binding ItemMasterCode}" Width="120"/>
                            <DataGridTextColumn Header="用品名称" Binding="{Binding ItemName}" Width="2*"/>
                            <DataGridTextColumn Header="所属类别" Binding="{Binding CategoryName}" Width="120"/>
                            <DataGridTextColumn Header="尺码/规格" Binding="{Binding Size}" Width="100"/>
                            <DataGridTextColumn Header="单位" Binding="{Binding UnitOfMeasure}" Width="80"/>
                            <DataGridTextColumn Header="当前库存" Binding="{Binding CurrentStock}" Width="80"/>
                            <DataGridTextColumn Header="低库存阈值" Binding="{Binding LowStockThreshold}" Width="100"/>
                            <DataGridTextColumn Header="预计寿命(天)" Binding="{Binding ExpectedLifespanDays}" Width="100"/>
                            <DataGridTextColumn Header="默认备注" Binding="{Binding DefaultRemarks}" Width="2*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>